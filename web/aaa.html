
<head>
<title>测试AJAX</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">  
/**
  jQuery.validator.setDefaults({
	submitHandler: function(form) { 
	  //alert(validator);
	 // alert("submitted!"); 
	 // document.getElementByID("queryForm").submit(); 
	 jQuery("#queryForm").masked("请等待...");
	 form.submit();
	  //document.getElementById("queryForm").submit(); 
	 // $(form).ajaxSubmit();
  }
});
**/


    function alt() {  
        jQuery.getJSON("json-test.do", function(json){alert(json.name);});  
    }
  
    function altTest() {  
        jQuery.getJSON("json-test!test.do", function(json){alert(json.name);});  
    }
    
    function altTestObj() {  
        jQuery.getJSON("json-test!testObj.do",{name:"测试中文",age:20} , function(json){
        testObj(json);
        });  
    }
    function testObj(json){
          //alert(json.name);
          // alert(json.test.testa);
           //alert(json.testPage.totalCount);
          // alert(json.testPage.result);
           var htmlstr=""; 
          // for(i=0;i<json.testPage.result.length;i++)
             // htmlstr+=json.testPage.result[i].housetypename+"<br/>";
                //这样
             // jQuery.each(json.testPage.result,function(i){ 
            	//  $("#div1").append("<li>Id:"+json.testPage.result[i].housetypeid+"&nbsp; Name:"+json.testPage.result[i].housetypename+"</li>") 
            	//或者
            	 jQuery.each(json.testPage.result,function(i,ht){ 
            	jQuery("#div1").append("<li>Id:"+ht.housetypeid+"&nbsp; Name:"+ht.housetypename+"</li>") 
            	  }); 
       // alert(jQuery('#div1').html());
        //jQuery("#div1").html(htmlstr);
        //jQuery("#div1")[0].innerHTML=htmlstr;   
         //div1.innerHTML=htmlstr;   
                   

                //jQuery("div").empty();   
          
                //jQuery("div").remove();   
        //jQuery("div").hide(1000);   
       // jQuery("div").show(2000);
       // jQuery("#div2").hide();  
        //jQuery("#div1").hide(1000);    
       //jQuery("#div2").show();   
    }
             
/*             validate插件 
    $(document).ready(function(){ 
    $("#commentForm").validate(); 
}); 
    commentForm为form对应的ID 
    input对应的class为验证方法，如：class="required"，class="required email"等， 
    可通过设置title来显示错误信息 
 class="{required:true,minlength:5}" /> 使用class="{}"的方式，必须引入包：jquery.metadata.js
 class="{required:true,minlength:5,messages:{required:'请输入内容'}}"
在使用equalTo关键字时，后面的内容必须加上引号，如下代码：
class="{required:true,minlength:5,equalTo:'#password'}"   
    也可以自定义validate,这样可以使input能干干净净的，如： */

   ajaxSub = function() {  
       //jQuery('#login_tmp').remove();  
       var options = {  
           type : "post",  
           dataType : "json",  
           url : "$base/json-test!testObj.do",  
           //data : {"userID" : 1111,"a":$("#a").val()},  
           //cache : "false",  
           beforeSubmit : beforeCallBack,  
          success : successCallBack,  
          error : errorCallBack  
      };  
      // 异步提交登陆请求  
      jQuery("#queryForm").ajaxSubmit(options);  
  }  
  function beforeCallBack(){
  alert("beforeCallBack");
  }
  function successCallBack(data){
   alert("successCallBack:"+data.name);
  }
  function errorCallBack(data){ 
   alert("errorCallBack:"+data.message);
  }

jQuery(document).ready(function(){      
//jQuery().ready(function(){      
var validator =jQuery("#queryForm").validate({ 
	debug:true,
	//event:"keyup",
	
	  submitHandler:function(form){
            //alert("submitted");
            /**
            if(confirm('确认提交数据？')){
            	jQuery("#queryForm").masked("请等待...");
            	//document.getElementById("queryForm").submit(); 
            	form.submit();
            }
            **/
            ajaxSub();
            return false;
        },
        
/**      
rules: { 
a: "required" ,
//firstname: "required",
'user.firstname':{
required: true,	
rangelength:[2,20]	
},
email: {
required: true,
email: true
},
password: {
required: true,
minlength: 5
},
confirm_password: {
required: true,
minlength: 5,
equalTo: "#password"
}
}, 
**/
messages: {
//firstname: "请输入姓名",
'user.firstname':{
required:"请输入姓名",
rangelength:jQuery.format("请输入一个长度介于 {0} 和 {1} 之间的姓名")
},
email: {
required: "请输入Email地址",
email: "请输入正确的email地址"
},
password: {
required: "请输入密码",
minlength: jQuery.format("密码不能小于{0}个字符")
},
confirm_password: {
required: "请输入确认密码",
minlength: "确认密码不能小于5个字符",
equalTo: "两次输入密码不一致"
}
}
});
$("#reset").click(function() {
        validator.resetForm();
    })
});
    
    jQuery(document).ready(function(){  
    	  /***
   jQuery("#queryForm").validate();  

   	jQuery("#submit").bind("click", function () {
					jQuery("#queryForm").masked("请等待...");
				});
				
				jQuery("#cancelbtn").bind("click", function () {
					jQuery("#queryForm").unmasked();
				});	
				***/		
 });


</script>  
</head>

<body>
	<script type='text/javascript' src='$base/js/autocomplete/jquery.bgiframe.min.js'></script>
<script type='text/javascript' src='$base/js/autocomplete/jquery.ajaxQueue.js'></script>
<script type='text/javascript' src='$base/js/autocomplete/thickbox-compressed.js'></script>
<script type='text/javascript' src='$base/js/autocomplete/jquery.autocomplete.js'></script>
<link href="$base/css/autocomplete/jquery.autocomplete.css" rel="stylesheet" type="text/css" />
<link href="$base/css/autocomplete/thickbox.css" rel="stylesheet" type="text/css" />
<div id="container">
<form action="$base/bbbhello.do" method="post" id="queryForm" name="queryForm" class="niceform">
	<fieldset>
    	<legend>输入验证</legend>
    	#set($i=2)
		
    	 <dl>
        	<dt><label for="hello">Hello:</label></dt>
            <dd>hello $i !!!</dd>
        </dl>
         <dl>
        	<dt><label for="href">Href:</label></dt>
            <dd><a href="bbb.do?a=2">link2</a></dd>
        </dl>
        <dl>
        	<dt><label for="tautocomplete">Autocomplete:</label></dt>
            <dd><input type="text" name="tautocomplete" id="tautocomplete" size="32" maxlength="128" /></dd>
        </dl>
        <dl>
        	<dt><label for="firstname">Firstname:</label></dt>
            <dd><input type="text" name="user.firstname" id="user.firstname" size="32" maxlength="32"/></dd>
        </dl>
        <dl>
        	<dt><label for="email">Email:</label></dt>
            <dd><input type="text" name="email" id="email" size="32" maxlength="32" /></dd>
        </dl>
        <dl>
        	<dt><label for="password">Password:</label></dt>
            <dd><input type="password" name="password" id="password" size="32" maxlength="32" /></dd>
        </dl>
        <dl>
        	<dt><label for="confirm_password">确认密码:</label></dt>
            <dd><input type="password" name="confirm_password" id="confirm_password" size="32" maxlength="32" /></dd>
        </dl>
         <dl>
        	<dt><label for="a">A:</label></dt>
           <dd> <input type="text" name="a" id="a" size="32" maxlength="32" /> </dd> 
        </dl>
        <!-- 
        <table border="0">
        <tr>
        <td>
         1:
        </td>
          <td>
         <input type="text" />
        </td>
         <td>
         2:
        </td>
          <td>
         <input type="text" />
        </td>
        </tr>
         <tr>
        <td>
         1:
        </td>
          <td>
         <input type="text" />
        </td>
         <td>
         2:
        </td>
          <td>
         <input type="text" />
        </td>
        </tr>
        </table>
         -->
    </fieldset>
    <fieldset>
    	<legend>控制输入</legend>
         <dl>
        	<dt><label for="date">Date:</label></dt>
            <dd><input type="text" name="date" id="date" size="32" maxlength="128" />&nbsp;&nbsp;99/99/9999</dd>
        </dl>
         <dl>
        	<dt><label for="phone">Phone:</label></dt>
            <dd><input type="text" name="phone" id="phone" size="32" maxlength="128" />&nbsp;&nbsp;(999) 999-9999</dd>
        </dl>
         <dl>
        	<dt><label for="phoneext">Phone + Ext:</label></dt>
            <dd><input type="text" name="phoneext" id="phoneext" size="32" maxlength="128" />&nbsp;&nbsp;(999) 999-9999? x99999</dd>
        </dl>
         <dl>
        	<dt><label for="tin">Tax ID:</label></dt>
            <dd><input type="text" name="tin" id="tin" size="32" maxlength="128" />&nbsp;&nbsp;99-9999999</dd>
        </dl>
         <dl>
        	<dt><label for="ssn">SSN:</label></dt>
            <dd><input type="text" name="ssn" id="ssn" size="32" maxlength="128" />&nbsp;&nbsp;999-99-9999</dd>
        </dl>
         <dl>
        	<dt><label for="product">Product Key:</label></dt>
            <dd><input type="text" name="product" id="product" size="32" maxlength="128" />&nbsp;&nbsp;a*-999-a999</dd>
        </dl>
         <dl>
        	<dt><label for="eyescript">Eye Script:</label></dt>
            <dd><input type="text" name="eyescript" id="eyescript" size="32" maxlength="128" />&nbsp;&nbsp;~9.99 ~9.99 999</dd>
        </dl>
        <dl>
        	<dt><label for="test">Test:</label></dt>
            <dd><input type="text" name="test" id="test" size="32" maxlength="128" />&nbsp;&nbsp;00:00 - 23:59</dd>
        </dl>
    </fieldset>
    <fieldset class="action">
    #token()
    	<input type="submit" name="submitbtn" id="submitbtn" value="提交" />&nbsp;&nbsp;<input type="reset" name="reset" id="reset" value="重置" />
    	&nbsp;&nbsp;	<input type="button" id="cancelbtn" value="取消"/>
    </fieldset>
</form>
 <button id="a" onclick="alt();">点我-Default</button>  
<button id="b" onclick="altTest();">点我-Test</button>
<button id="b" onclick="altTestObj();">点我-TestObj</button>    
			<div id="div1">
	</div>
		<div id="div2">
		测试empty
	</div>
	<div id="div3">
		测试remove
	</div>
</div>
<script>
		jQuery(function(jQuery){
   jQuery("#date").mask("99/99/9999");
   jQuery("#phone").mask("(999) 999-9999");
   jQuery("#phoneext").mask("(999) 999-9999? x99999");
   jQuery("#tin").mask("99-9999999");
   jQuery("#ssn").mask("999-99-9999");
   //jQuery("#product").mask("99/99/9999",{placeholder:" "});
   //jQuery("#product").mask("a*-999-a999");
   $("#product").mask("a*-999-a999",{completed:function(){alert("You typed the following: "+this.val());}});
   jQuery.mask.definitions['~']='[+-]';
   jQuery("#eyescript").mask("~9.99 ~9.99 999");
   //jQuery("#test").mask("99小时99分钟",{pattern: "^(([0-1]*[0-9])|(2[0-3])):[0-5][0-9]"});
   jQuery("#test").mask("99小时99分钟");
});

jQuery(document).ready(function(){  
    $("#tautocomplete").autocomplete("json-test!testObj.do", {
    //extraParams: {name:function(){return $('#tautocomplete').val();}},       
      //multiple: true,    
      autoFill:true,
      width:$("#tautocomplete").width(),       
      max:50,       
      //multipleSeparator: ',', 
      //delay:10,     
      //dataType: 'json',    
     // cacheLength:1,
     //加入对返回的json对象进行解析函数，函数返回一个数组         
      parse: function(data) {
      //alert($("#tautocomplete").val());
      var results=data.testPage.result;
      //alert(results);     
         var parsed = [];     
        for(var i=0; i<results.length; i++){     
      // alert( results[i].housetypename);
       /**
         rows[rows.length] = {      
           data:results[i].housetypeid      
           //value:results[i].housetypeid,      
           //result:results[i].housetypeid      
           };  
           */    
           parsed[parsed.length] = {
                //data: results[i].housetypeid+"-"+results[i].housetypename,
                data: results[i],
         //返回的json数据：{["kindname":"a"},["kindname":"b"]}
                value: results[i].housetypeid,
                result:results[i].housetypename
            };
         }     
      return parsed;     
        },     
      formatItem: function(item,i,max) {
        //return "<i>"+item.housetypename+"|"+i+"|"+max+"</i>";
        //return item+"|"+i+"|"+max;
        return item.housetypename;
    }
   //,formatMatch: function(item){return item.housetypename;}
    //formatResult: function(item){return item.housetypename+"result"; }
   });   
    });  
		</script>
</body>

